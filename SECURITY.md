# ิฟีกีตึีซ ึ ีฃีธีพีกีฆีคีกีตีซีถ ีฅีฏีกีดีฟีซ ีบีกีทีฟีบีกีถีธึีฉีตีธึีถ

ีีกีถึีกีดีกีฝีถ ีผีกีฆีดีกีพีกึีธึีฉีตีธึีถี ีขีธีฟีฅึีซึ, ีกีขีตีธึีฆีซึ ึ ีกีถีพีกีพีฅึ ีฟึีกึีซีฏีซึ ีบีกีทีฟีบีกีถีพีฅีฌีธึ ีฐีกีดีกึึ

---

## 1. ิปีถีน ีกึีคีฅีถ ีซึีกีฏีกีถีกึีพีกีฎ ีง

### Adblock ีคีฅีฟีฅีฏึีซีก
- **ีีกีตีฌีฅึ:** `hooks/use-adblock-detector.ts`, `components/adblock-warning.tsx`
- ิณีธึีฎีซึีจ ีขีกึีกีฐีกีตีฟีธึีด ีง ad blocker-ีจ (5 ีดีฅีฉีธีค) ึ 1 ึีธีบีฅีซึ ีฐีฅีฟีธ ึีธึึีกีคึีธึีด ีง ีฆีฃีธึีทีกึีธึีด / ีกึีฃีฅีฌีธึีด ีง ีฏีกีตึีซ ึีฃีฟีกีฃีธึีฎีธึีดีจ, ีดีซีถีนึ ีฃีธีพีกีฆีคีถีฅึีจ ีดีซีกึีพีกีฎ ีฌีซีถีฅีถึ
- ิฑีตีฝีบีซีฝีธีพ **ีฃีธีพีกีฆีคีกีตีซีถ ีฅีฏีกีดีธึีฟีจ** ีบีกีทีฟีบีกีถีพีกีฎ ีง ีกีตึีฅีฌีธึีถีฅึีซึ, ีธีพึีฅึ ีกึีฃีฅีฌีกึีกีฏีธึีด ีฅีถ ีฃีธีพีกีฆีคีถีฅึีจึ

### ิฒีธีฟีฅึีซ ีกึีฃีฅีฌีธึีด (middleware)
- **ีีกีตีฌ:** `middleware.ts`
- **Security headers:** `X-Frame-Options`, `X-Content-Type-Options`, `Referrer-Policy`, `Permissions-Policy` โ ีฏึีณีกีฟีธึีด ีฅีถ clickjacking-ีจ, MIME sniffing-ีจ ึ ีกีพีฅีฌีธึีค permissions-ีจึ
- **User-Agent ึีซีฌีฟึ:** `/api/download` ึ `/api/search` ีฐีกึึีธึีดีถีฅึีจ **ีดีฅึีชีพีธึีด ีฅีถ**, ีฅีฉีฅ User-Agent-ีจ ีถีดีกีถ ีง ีขีธีฟีซ/ีฝึึีฅีตีบีฅึีซ (curl, wget, python, headless, scraper, bot, crawler ึ ีกีตีฌีถ)ึ
- ิปึีกีฏีกีถ ีขึีกีธึีฆีฅึีถีฅึีจ (Chrome, Firefox, Safari, Edge) **ีกีถีกึีฃีฅีฌ** ีฅีถึ

### Rate limiting (API)
- **ีีกีตีฌีฅึ:** `lib/rate-limit.ts`, `app/api/download/route.ts`, `app/api/search/route.ts`
- **Download API** (prepare, prepare_poster, download): **15 ีฐีกึึีธึีด / ึีธีบีฅ / IP** โ 429 + `Retry-After` ีฅีฉีฅ ีฃีฅึีกีฆีกีถึีพีซึ
- **Search API:** **30 ีฐีกึึีธึีด / ึีธีบีฅ / IP** โ ีถีธึีตีถ ีฝีฏีฆีขีธึีถึีธีพึ
- ีีกีฐีดีกีถีกึีกีฏีธึีดีจ **IP-ีธีพ** ีง (x-forwarded-for / x-real-ip), ีธึีจ ีกึีคีตีธึีถีกีพีฅีฟ ีง ีขีธีฟีฅึีซ ึ ีกีขีตีธึีฆีซ ีคีฅีดึ

### Analytics ึ ีถีธึีตีถีกีฏีกีถีกึีธึีด
- **ีีกีตีฌ:** `lib/analytics.ts`
- `generateUserId(ip, userAgent)` โ ึีฃีฟีกีฃีธึีฎีพีธึีด ีง ีถีฅึีขีฅีผีถีธึีดีถีฅึีถ ีธึ session-ีถีฅึีจ ีณีซีทีฟ ีฐีกีทีพีฅีฌีธึ ีฐีกีดีกึ, ีธีน ีฉีฅ ีขีธีฟีฅึีซีถ ยซีดีกึีคยป ีฐีกีดีกึีฅีฌีธึึ

---

## 2. ิฝีธึีฐีธึึีคีถีฅึ ีกึีฟีกีคึีธึีฉีตีกีถ (production) ีฐีกีดีกึ

### Rate limiting ีดีกีฝีทีฟีกีขีธีพ
- **ิธีถีฉีกึีซีฏ:** In-memory store (`lib/rate-limit.ts`) โ serverless-ีธึีด ีตีธึึีกึีกีถีนีตีธึึ instance ีธึีถีซ ีซึ ีฐีซีทีธีฒีธึีฉีตีธึีถีจ, ีกีตีถีบีฅีฝ ีธึ limit-ีจ **instance-ีซ** ีถีฏีกีฟีดีกีดีข ีง, ีธีน ีกีดีขีธีฒีป ีฏีกีตึีซึ
- **ิฝีธึีฐีธึึีค:** ีีฅีฎ ีฟึีกึีซีฏีซ ีคีฅีบึีธึีด ึีฃีฟีกีฃีธึีฎีฅีฌ **Redis** (ึึ. [Upstash](https://upstash.com), Vercel KV) โ ีถีธึีตีถ key-ีซ limit-ีจ ีฏีฌีซีถีซ ีขีธีฌีธึ instance-ีถีฅึีซ ีฐีกีดีกึึ
- ีึีซีถีกีฏี `@upstash/ratelimit` + Redis endpoint, ึ `lib/rate-limit.ts`-ีธึีด env-ีธีพ ีจีถีฟึีฅีฌ in-memory vs Redisึ

### ิณีธีพีกีฆีคีกีตีซีถ ึีกีถึีฅึ (Invalid traffic)
- **Google AdSense / ีกีตีฌ ึีกีถึีฅึ** ีฏีกึีธีฒ ีฅีถ ีฑีฅีฆ ีถีทีฅีฌ invalid traffic-ีซ ีฐีกีดีกึ, ีฅีฉีฅ ีทีกีฟ ีฏีฌีซีฏีถีฅึ/ีฟึีกึีซีฏ ีขีธีฟีฅึีซึ ีฅีถึ
- ิฑีตีฝีฟีฅีฒ **ีดีซีปีธึีถีฅึีถ ีกึีคีฅีถ ึีฃีถีธึีด ีฅีถ.**  
  - ิฒีธีฟีฅึีซ ีกึีฃีฅีฌีธึีด download/search API-ีธึีด โ ีกีพีฅีฌีซ ึีซีน ยซีฝีซีถีฉีฅีฟีซีฏยป ึีฃีฟีกีฃีธึีฎีธึีดึ  
  - Rate limit โ ีกีพีฅีฌีซ ึีซีน ีกีขีตีธึีฆ ึ ีกีพีฟีธีดีกีฟีกึีพีกีฎ ีฐีกึึีธึีดีถีฅึึ  
  - Adblock ีคีฅีฟีฅีฏึีซีก โ ีกีพีฅีฌีซ ีทีกีฟ ีซึีกีฏีกีถ ึีธึึีกีคึีธึีดีถีฅึ ีกีตึีฅีฌีธึีถีฅึีซึ, ีธีพึีฅึ ีนีฅีถ ีกึีฃีฅีฌีกึีกีฏีธึีด ีฃีธีพีกีฆีคีจึ
- ิผึีกึีธึึีซีนี AdSense-ีธึีด ีฏีกึีธีฒ ีฅึ ีดีซีกึีถีฅีฌ **invalid traffic protection** (ีฅีฉีฅ ีกีผีกีปีกึีฏีพีซ) ึ ีฐีฅีฟึีฅีฌ **Policy center**-ีซีถึ

### Cloudflare โ DDoS ึ Bot Management (ีจีถีฟึีธีพีซ)

**ิปีถีน ีง Cloudflare-ีจ:** CDN ึ ีกีถีพีฟีกีถีฃีธึีฉีตีกีถ ีฝีฅึีพีซีฝ, ีธึีจ ีฏีกีถีฃีถีธึีด ีง **ีฑีฅึ ีฏีกีตึีซ ีคีซีดีกึ** (proxy). ีขีธีฌีธึ ีกีตึีฅีฌีธึีถีฅึีถ ีกีผีกีป ีฐีกึึีธึีดีจ ีฃีถีธึีด ีฅีถ Cloudflare-ีซ ีฝีฅึีพีฅึีถีฅึ, ีกีบีก โ ีฑีฅึ Vercel/ีฐีธีฝีฉีซีถีฃึ

- **DDoS mitigation (DDoS-ีซึ ีบีกีทีฟีบีกีถีธึีฉีตีธึีถ):** ิตึีข ีซีถีน-ีธึ ีดีฅีฏีจ ีฐีกีฆีกึีกีพีธึ/ีดีซีฌีซีธีถีกีพีธึ ีฏีฅีฒีฎ ีฐีกึึีธึีดีถีฅึ ีง ีธึีฒีกึีฏีธึีด ีฏีกีตึีซีถ (ีธึีบีฅีฝีฆีซ ยซีญีฅีฒีคีซยป ีฝีฅึีพีฅึีจ), Cloudflare-ีจ ีณีกีถีกีนีธึีด ึ **ีฏีฟึีธึีด** ีง ีกีตีค ีฟึีกึีซีฏีจ, ีดีซีถีนึ ีกีตีถ ีฐีกีฝีถีซ ีฑีฅึ ีฝีฅึีพีฅึีซีถึ ิฑีถีพีณีกึ ีบีฌีกีถีธึีด ีกึีคีฅีถ ีฐีซีดีถีกีฏีกีถ DDoS ีบีกีทีฟีบีกีถีธึีฉีตีธึีถ ีฏีกึ
- **Bot management:** Cloudflare-ีจ ีพีฅึีฌีธึีฎีธึีด ีง ีฐีกึึีธึีดีถีฅึีจ (IP, User-Agent, ีพีกึึ) ึ ีฏีกึีธีฒ ีง **ีกีพีฟีธีดีกีฟ ีกึีฃีฅีฌีฅีฌ** ีฏีกีฝีฏีกีฎีฅีฌีซ ีขีธีฟีฅึีซีถ, ึีธึีตึ ีฟีกีฌ CAPTCHA ีฏีกีด ีฉีธึีตีฌ ีฟีกีฌ ีดีซีกีตีถ ยซีซึีกีฏีกีถยป ีขึีกีธึีฆีฅึีถีฅึีซีถึ ิดีธึึ reCAPTCHA ีนีฅึ ีกีพีฅีฌีกึีถีธึีด ีฏีกีตึีธึีด โ ีกีตีค ีกีทีญีกีฟีกีถึีจ (ีกีถ optionally) ีฏีกึีธีฒ ีง ีกีถีฅีฌ Cloudflare-ีจ ีซึ ีฏีธีฒีดีซึึ
- **Firewall rules:** ิฟีกึีธีฒ ีฅึ ีฏีกีถีธีถีถีฅึ ีคีถีฅีฌ, ึึีซีถีกีฏ ีกึีฃีฅีฌีฅีฌ ีธึีธีท ีฅึีฏึีถีฅึีซึ, ีฏีธีถีฏึีฅีฟ IP-ีถีฅึีซึ ีฏีกีด ีฐีกีตีฟีถีซ ีพีถีกีฝีกีฏีกึ ึีกีถึีฅึีซึ (ASN) ีดีธึีฟึีจึ

**ิฑึีคีตีธึ ีบีกึีฟีกีคีซึ ีง:** ีีนึ Vercel-ีจ ีกึีคีฅีถ ีฟีกีฌีซีฝ ีง DDoS protection; ีฑีฅึ ีฏีธีคีธึีด ีกึีคีฅีถ ีฏีก rate limit ึ User-Agent ึีซีฌีฟึึ Cloudflare-ีจ **ีฌึีกึีธึึีซีน** ีง, ีฅึีข ึีกีถีฏีกีถีธึีด ีฅึ ีกีพีฅีฌีซ ีญีซีฝีฟ ีฏีกีถีธีถีถีฅึ, ีกีพีฅีฌีซ ีดีฅีฎ ีฐีกึีฑีกีฏีธึีดีถีฅึีซ ีคีฅีด ีบีกีทีฟีบีกีถีธึีฉีตีธึีถ ีฏีกีด bot management ีกีผีกีถึ reCAPTCHA-ีซ ีฑีฅึ ีฏีกีตึีธึีดึ

### ีีธีฝีฉีซีถีฃ
- **Vercel** โ ีกึีคีฅีถ ีฟีกีฌีซีฝ ีง DDoS protection ึ geo; Cloudflare-ีจ (ีฅีฉีฅ ีจีถีฟึีฅึ) ีคีถีธึีด ีฅึ domain-ีซ DNS-ีธึีด Vercel-ีซ ีคีซีดีกึ, ีธึีบีฅีฝ proxyึ

### robots.txt
- **ีีกีตีฌ:** `app/robots.ts` โ ีกึีคีฅีถ ีกึีฃีฅีฌีธึีด ีง `/admin` ึ `/api/` crawl-ีจ, ีซีถีนีจ ีถีพีกีฆีฅึีถีธึีด ีง ีธึีธีถีดีกีถ ีขีธีฟีฅึีซ ีกีพีฅีฌีธึีค ีขีฅีผีจ API-ีซ ีพึีกึ

---

## 3. ิฑีดึีธึีธึีด

| ีีบีกีฟีกีฏ | ีีซีปีธึ | ิฟีกึีฃีกีพีซีณีกีฏ |
|--------|--------|-------------|
| ิณีธีพีกีฆีคีกีตีซีถ ีฅีฏีกีดีธึีฟ | Adblock ีคีฅีฟีฅีฏึีซีก + ีฆีฃีธึีทีกึีธึีด | โ ิฟีซึีกีผีพีกีฎ |
| ิฒีธีฟีฅึ / ีฝึึีฅีตีบีฅึีถีฅึ | User-Agent block (API) | โ ิฟีซึีกีผีพีกีฎ |
| API ีกีขีตีธึีฆ | Rate limit (download, search) | โ ิฟีซึีกีผีพีกีฎ |
| ิฑีถีพีฟีกีถีฃีธึีฉีตีกีถ headers | Middleware | โ ิฟีซึีกีผีพีกีฎ |
| Invalid traffic (AdSense) | ิฒีธีฟ block + rate limit | โ ีีพีกีฆีฅึีพีกีฎ ีผีซีฝีฏ |
| ีีกีฝีทีฟีกีข (multi-instance) | Redis rate limit | ๐ ิฝีธึีฐีธึึีค production-ีซ ีฐีกีดีกึ |
| ิผึีกึีธึึีซีน (optional) | Cloudflare DDoS/bot | ๐ ิธีฝีฟ ีกีถีฐึีกีชีฅีทีฟีธึีฉีตีกีถ |

ิฑีตีฝ ีณีกีถีกีบีกึีฐีธีพ ีฏีกีตึีจ ึ ีฃีธีพีกีฆีคีถีฅึีซึ ีฝีฟีกึีพีธีฒ ีฅีฏีกีดีธึีฟีจ **ีบีกีทีฟีบีกีถีพีกีฎ ีฅีถ** ีขีธีฟีฅึีซึ ึ ีฐีซีดีถีกีฏีกีถ ีกีขีตีธึีฆีซึ; ีกึีฟีกีคึีธึีฉีตีกีถ ีดีกีฝีทีฟีกีขีซ ึ AdSense policy-ีซ ีฐีกีดีกึ ีฏีกึีธีฒ ีฅึ ีกีพีฅีฌีกึีถีฅีฌ Redis rate limit ึ (ีกีถีฐึีกีชีฅีทีฟีธึีฉีตีกีถ ีคีฅีบึีธึีด) Cloudflareึ
